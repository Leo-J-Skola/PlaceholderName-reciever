<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>StreamWeave Receiver (v2, Web Page Loader)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="//www.gstatic.com/cast/sdk/libs/receiver/2.0.0/cast_receiver.js"></script>
  <style>
    html,body{margin:0;padding:0;height:100%;background:#000;color:#ddd;font-family:Segoe UI,Roboto,Arial,sans-serif}
    #a,#b{position:absolute;inset:0;width:100%;height:100%;border:0;background:#000;opacity:0;transition:opacity .25s}
    .show{opacity:1}
    #splash{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:#aaa}
    #status{position:absolute;left:0;right:0;bottom:0;padding:8px 12px;background:rgba(0,0,0,.55);font-size:13px}
  </style>
</head>
<body>
  <div id="splash">Waiting for URL…</div>
  <iframe id="a" allow="autoplay; fullscreen"></iframe>
  <iframe id="b" allow="autoplay; fullscreen"></iframe>
  <div id="status"></div>
  <script>
    var NAMESPACE = 'urn:x-cast:streamweave.cast';
    var forceQS = (new URLSearchParams(location.search).get('force') || '').toLowerCase();
    var forceDefault = (forceQS === '1' || forceQS === 'true');

    var statusEl = document.getElementById('status');
    var splashEl = document.getElementById('splash');
    var a = document.getElementById('a'), b = document.getElementById('b'), current = a, candidate = b;

    function setStatus(s){ statusEl.textContent = s || ''; }
    function swap(){
      candidate.classList.add('show');
      current.classList.remove('show');
      var t=current; current=candidate; candidate=t;
    }
    function loadInIframe(url){
      setStatus('Loading: ' + url);
      splashEl.style.display='none';
      candidate.classList.remove('show');
      candidate.src='about:blank';
      setTimeout(function(){
        candidate.onload=function(){
          setStatus('Opened page: ' + url);
          swap();
          candidate.onload=null;
        };
        candidate.src=url;
      },0);
    }

    function forceNavigate(url){
      setStatus('Force loading: ' + url);
      splashEl.style.display='none';
      setTimeout(function(){ window.location.href = url; }, 250);
    }

    cast.receiver.logger.setLevelValue(0);
    window.castReceiverManager = cast.receiver.CastReceiverManager.getInstance();
    castReceiverManager.onReady = function(){ setStatus('Waiting for URL…'); };

    var messageBus = castReceiverManager.getCastMessageBus(NAMESPACE);
    messageBus.onMessage = function(event){
      try{
        var data = event && event.data ? JSON.parse(event.data) : {};
        if(!data || data.type !== 'LOAD_URL' || !data.url){ setStatus('Invalid LOAD_URL payload'); return; }
        var url = String(data.url);
        var useForce = (typeof data.force === 'boolean') ? data.force : forceDefault;
        if(useForce) forceNavigate(url); else loadInIframe(url);
        messageBus.send(event.senderId, JSON.stringify({ ok:true, url }));
      }catch(ex){
        setStatus('Error: ' + (ex && ex.message ? ex.message : ex));
      }
    };

    castReceiverManager.start({ statusText: 'Receiver starting' });
    window.addEventListener('keydown', function(e){
      if((e.key||'').toLowerCase()==='f'){
        forceDefault = !forceDefault;
        setStatus('Force Display is now ' + (forceDefault ? 'ON' : 'OFF'));
      }
    });
  </script>
</body>
</html>
